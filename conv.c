// تابع کانولوشن دو بعدی  (نسخه ساده C بدون SIMD)
// in  : تصویر ورودی
// out : تصویر خروجی
// ker : کرنل k×k
// w,h : عرض و ارتفاع تصویر
// k   : اندازه کرنل
void conv2d_c(float* in, float* out, float* ker,
              int w, int h, int k)
{
    int pad = k / 2;   // تعداد پیکسل‌های حاشیه (مثلاً برای 3×3 → 1)
    // پیمایش سطرهای تصویر
    for (int y = 0; y < h; y++)
    {
        // پیمایش ستون‌های تصویر
        for (int x = 0; x < w; x++)
        {
            float sum = 0.0f;   // جمع وزن‌دار همسایه‌ها (نتیجه کانولوشن این پیکسل)
            // پیمایش سطرهای کرنل
            for (int ky = 0; ky < k; ky++)
            {
                // پیمایش ستون‌های کرنل
                for (int kx = 0; kx < k; kx++)
                {
                    // مختصات پیکسل متناظر در تصویر ورودی
                    // (مرکز کرنل روی پیکسل (x,y) قرار می‌گیرد)
                    int ix = x + kx - pad;
                    int iy = y + ky - pad;
                    // بررسی اینکه از مرز تصویر خارج نشویم 
                    if (ix >= 0 && ix < w && iy >= 0 && iy < h)
                    {
                        // خواندن مقدار پیکسل همسایه از تصویر
                        float pixel = in[iy*w + ix];
                        // خواندن وزن کرنل به صورت flipped
                        float weight = ker[(k-1-ky)*k + (k-1-kx)];
                        // ضرب وزن در پیکسل و اضافه به مجموع
                        sum += pixel * weight;
                    }
                }
            }
            // ذخیره مقدار نهایی در تصویر خروجی
            out[y*w + x] = sum;
        }
    }
}